{% extends "base.html" %}
{% block title %}Cart{% endblock title %}

{% block body %}
<div class="container mx-auto px-4 py-8">
  <h1 class="text-white text-3xl md:text-4xl font-extrabold mb-8">Your Cart</h1>
  
  <div class="flex flex-col lg:flex-row lg:space-x-8">
    <!-- Cart Items -->
    <div class="w-full lg:w-2/3 mb-8 lg:mb-0">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
              <tr>
                <th scope="col" class="px-4 py-3">Player</th>
                <th scope="col" class="px-4 py-3">Tournament</th>
                <th scope="col" class="px-4 py-3">Category</th>
                <th scope="col" class="px-4 py-3">Price</th>
                <th scope="col" class="px-4 py-3">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for item in cart %}
              <tr class="border-b dark:border-gray-700">
                <td class="px-4 py-3 font-medium text-gray-900 dark:text-white">
                  {{ item.members }}
                </td>
                <td class="px-4 py-3">{{ item.category.tournament.name }}</td>
                <td class="px-4 py-3">{{ item.category.catagory_type }}</td>
                <td class="px-4 py-3">₹{{ item.category.price }}</td>
                <td class="px-4 py-3">
                  <button class="text-red-500 hover:text-red-700 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                  </button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Billing Summary -->
    <div class="w-full lg:w-1/3">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Order Summary</h2>
        <div class="space-y-4">
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Subtotal</span>
            <span class="font-medium text-gray-900 dark:text-white">₹{{ total }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Tax</span>
            <span class="font-medium text-gray-900 dark:text-white">-</span>
          </div>
          <div class="border-t pt-4">
            <div class="flex justify-between">
              <span class="text-lg font-semibold text-gray-900 dark:text-white">Total</span>
              <span class="text-lg font-semibold text-gray-900 dark:text-white">₹{{ total }}</span>
            </div>
          </div>
          <button id="pay-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 mt-6">
            Proceed to Payment
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  document.getElementById("pay-btn").onclick = (e) => {
    e.preventDefault();
    const url = "{% url 'api:create_order' %}";
    fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": "{{ csrf_token }}",
      },
      body: JSON.stringify({}),
    })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      const options = {
        key: data.razorpay_merchant_key,
        amount: data.razorpay_amount,
        currency: data.currency,
        name: 'SportsHunt',
        order_id: data.razorpay_order_id,
        callback_url: 'http://127.0.0.1:8000/checkout/',
        theme: {
          color: '#3B82F6'
        }
      };
      const rzp = new Razorpay(options);
      rzp.open();
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred. Please try again.');
    });
  };
</script>
{% endblock body %}